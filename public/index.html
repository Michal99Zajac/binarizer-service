<!DOCTYPE html>
<html>
<head>
    <title>Video Streaming Client</title>
</head>
<body>
    <h1>Video Streaming Client</h1>
    <video id="localVideo" autoplay></video>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script>
    const pc = new RTCPeerConnection();
    const video = document.querySelector("#localVideo");

    pc.ontrack = function (event) {
        video.srcObject = event.streams[0];
    };

    const ws = new WebSocket("ws://127.0.0.1:8000");

    ws.onmessage = function (event) {
        const msg = JSON.parse(event.data);
        if (msg.sdp) {
            const desc = new RTCSessionDescription(msg);
            pc.setRemoteDescription(desc).then(function () {
                if (desc.type == "offer") {
                    pc.createAnswer().then(function (answer) {
                        return pc.setLocalDescription(answer);
                    }).then(function () {
                        ws.send(JSON.stringify(pc.localDescription));
                    });
                }
            });
        } else if (msg.candidate) {
            pc.addIceCandidate(new RTCIceCandidate(msg.candidate));
        } else if (msg == "BYE") {
            ws.close();
        }
    };

    ws.onopen = function () {
        const offerOptions = {
            offerToReceiveAudio: 1,
            offerToReceiveVideo: 1
        };
        pc.createOffer(offerOptions).then(function (offer) {
            return pc.setLocalDescription(offer);
        }).then(function () {
            ws.send(JSON.stringify(pc.localDescription));
        });
    };
    </script>
</body>
</html>
