<!DOCTYPE html>
<html>
<head>
  <title>WebRTC Video Chat</title>
</head>
<body>
  <video id="localVideo" autoplay playsinline></video>
  <script>
    const pc = new RTCPeerConnection();
    const localVideo = document.querySelector('#localVideo');
    const ws = new WebSocket('ws://localhost:8000');

    // handle incoming messages from the signaling server
    ws.onmessage = function(event) {
      const msg = JSON.parse(event.data);
      if (msg.type === 'offer') {
        pc.setRemoteDescription(new RTCSessionDescription(msg))
          .then(() => pc.createAnswer())
          .then(answer => pc.setLocalDescription(answer))
          .then(() => ws.send(JSON.stringify(pc.localDescription)));
      } else if (msg.type === 'answer') {
        pc.setRemoteDescription(new RTCSessionDescription(msg));
      }
    };

    // get video/voice stream from webcam
    navigator.mediaDevices.getUserMedia({video: true, audio: true})
      .then(stream => {
        // Show stream in a video tag
        localVideo.srcObject = stream;

        // send stream to peer connection
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
      });

    pc.ontrack = function(event) {
      localVideo.srcObject = event.streams[0];
    };

    // create an offer
    pc.createOffer()
      .then(offer => pc.setLocalDescription(offer))
      .then(() => {
        // send the offer to the signaling server
        ws.send(JSON.stringify(pc.localDescription));
      });
  </script>
</body>
</html>
